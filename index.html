<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width,
                 height=device-height,
                 initial-scale=1.0,
                 maximum-scale=1.0,
                 user-scalable=no" />
  <title>Telegram Roulette</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* –í—Å–µ –≤–∞—à–∏ —Å—Ç–∏–ª–∏ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) */
    /* ... (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ –≤–∞—à–µ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –∫–æ–¥–∞) */
  </style>
</head>
<body>
<div id="app">
  <!-- –í—Å—è —Ä–∞–∑–º–µ—Ç–∫–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
  <!-- ... -->
</div>
<div class="modal" id="giftModal"><!-- ... --></div>

<script>
  const tg = Telegram.WebApp;
  tg.ready();
  tg.expand();

  document.querySelector('#videoWrapper video').playbackRate = 0.7;

  const centerVideo = document.querySelector('.center-video');
  if (centerVideo) {
    centerVideo.pause();
    centerVideo.currentTime = 0;
  }

  let selectedGifts = [null, null, null, null];
  let currentSelectedSlot = null;
  let currentSlotElement = null;
  let filledSlots = new Array(4).fill(false);
  let videoPlayTimeout = null;
  let fourthGiftSelected = false;

  // ========== –°–ü–ò–°–û–ö –ü–û–î–ê–†–ö–û–í, –î–õ–Ø –ö–û–¢–û–†–´–• –¢–û–ß–ù–û –ï–°–¢–¨ PNG –ò MP4 ==========
  const giftsWithMedia = new Set([
    "Astral Shard",
    "Kissed Frog",
    "Durov's Cap",
    "Artisan Brick"
  ]);

  // –ü–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –ø–æ–¥–∞—Ä–∫–æ–≤ (–∏–º–µ–Ω–∞ –∏ —ç–º–æ–¥–∑–∏)
  const rareGifts = [
    { name: "Durov's Cap", emoji: "üé©" },
    { name: "Top Hat", emoji: "üé©" },
    { name: "Astral Shard", emoji: "üíé" },
    { name: "Mini Oscar", emoji: "üèÜ" },
    { name: "Electric Skull", emoji: "üíÄ" },
    { name: "Diamond Ring", emoji: "üíç" },
    { name: "Stellar Rocket", emoji: "üöÄ" },
    { name: "Trapped Heart", emoji: "üíñ" },
    { name: "Gem Signet", emoji: "üîÆ" },
    { name: "Artisan Brick", emoji: "üß±" },
    { name: "Sharp Tongue", emoji: "üó°" },
    { name: "Jack-in-the-Box", emoji: "üéÅ" },
    { name: "Witch Hat", emoji: "üéÉ" },
    { name: "Moon Pendant", emoji: "üåô" },
    { name: "Lunar Snake", emoji: "üêç" },
    { name: "Holiday Drink", emoji: "ü•Ç" },
    { name: "Record Player", emoji: "üéµ" },
    { name: "Joyful Bundle", emoji: "üéâ" },
    { name: "Restless Jar", emoji: "ü´ô" },
    { name: "Big Year", emoji: "üéà" },
    { name: "Light Sword", emoji: "‚öîÔ∏è" },
    { name: "Jingle Bells", emoji: "üîî" },
    { name: "Eternal Candle", emoji: "üïØ" },
    { name: "Skull Flower", emoji: "üíÄüå∏" },
    { name: "Sakura Flower", emoji: "üå∏" },
    { name: "Jelly Bunny", emoji: "üê∞" },
    { name: "Cupid Charm", emoji: "üíò" },
    { name: "Hanging Star", emoji: "‚≠êÔ∏è" },
    { name: "Easter Egg", emoji: "ü•ö" },
    { name: "Spy Agaric", emoji: "üçÑ" },
    { name: "Homemade Cake", emoji: "üç∞" },
    { name: "Snow Globe", emoji: "‚ùÑÔ∏è" },
    { name: "Xmas Stocking", emoji: "üß¶" },
    { name: "Scared Cat", emoji: "üòø" },
    { name: "Spiced Wine", emoji: "üç∑" },
    { name: "Evil Eye", emoji: "üëÅ" },
    { name: "Ionic Dryer", emoji: "üí®" },
    { name: "Ginger Cookie", emoji: "üç™" },
    { name: "Hex Pot", emoji: "ü™£" },
    { name: "Snake Box", emoji: "üêçüì¶" },
    { name: "Loot Bag", emoji: "üí∞" },
    { name: "Love Candle", emoji: "‚ù§Ô∏èüïØ" },
    { name: "Love Potion", emoji: "üíï" },
    { name: "Kissed Frog", emoji: "üê∏" },
    { name: "Neko Helmet", emoji: "üê±‚õë" },
    { name: "Pet Snake", emoji: "üêç" },
    { name: "Jester Hat", emoji: "ü§°" },
    { name: "Flying Broom", emoji: "üßπ" },
    { name: "Party Sparkler", emoji: "‚ú®" },
    { name: "Star Notepad", emoji: "‚≠êÔ∏èüìù" },
    { name: "Voodoo Doll", emoji: "üéé" },
    { name: "Bonded Ring", emoji: "üíû" },
    { name: "Snow Mittens", emoji: "üß§" },
    { name: "Crystal Ball", emoji: "üîÆ" },
    { name: "Berry Box", emoji: "üçì" },
    { name: "Tama Gadget", emoji: "üì±" },
    { name: "Valentine Box", emoji: "üíù" },
    { name: "Cookie Heart", emoji: "‚ù§Ô∏èüç™" },
    { name: "Precious Peach", emoji: "üçë" },
    { name: "Bow Tie", emoji: "üéÄ" },
    { name: "Signet Ring", emoji: "üíé" },
    { name: "Lol Pop", emoji: "üç≠" },
    { name: "Santa Hat", emoji: "üéÖ" },
    { name: "Hypno Lollipop", emoji: "üç¨" },
    { name: "Winter Wreath", emoji: "üéÑ" },
    { name: "Vintage Cigar", emoji: "üö¨" },
    { name: "Bunny Muffin", emoji: "üê∞üßÅ" },
    { name: "Mad Pumpkin", emoji: "üéÉ" },
    { name: "Eternal Rose", emoji: "üåπ" },
    { name: "Jolly Chimp", emoji: "üêµ" },
    { name: "Toy Bear", emoji: "üß∏" },
    { name: "Candy Cane", emoji: "üç≠" },
    { name: "Sleigh Bell", emoji: "üîî" },
    { name: "Swiss Watch", emoji: "‚åöÔ∏è" },
    { name: "Genie Lamp", emoji: "ü™î" },
    { name: "Plush Pepe", emoji: "üê∏" },
    { name: "Perfume Bottle", emoji: "üí®" },
    { name: "Magic Potion", emoji: "üß™" },
    { name: "Ion Gem", emoji: "üíé" },
    { name: "Desk Calendar", emoji: "üóì" },
    { name: "B-Day Candle", emoji: "üïØ" }
  ];

  // –ú–∞—Ç—Ä–∏—Ü–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  const canvas = document.getElementById("matrix");
  const ctx = canvas.getContext("2d");
  let drops = [];
  const chars = "01ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789";
  const fontSize = 14;

  function initMatrix() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const columns = Math.floor(canvas.width / fontSize);
    drops = Array.from({ length: columns }, () => ({
      y: Math.random() * canvas.height,
      speed: 0.5 + Math.random() * 1.5
    }));
  }

  function drawMatrix() {
    ctx.fillStyle = "rgba(0, 0, 0, 0.08)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#00ff88";
    ctx.font = fontSize + "px monospace";

    drops.forEach((drop, i) => {
      const text = chars[Math.floor(Math.random() * chars.length)];
      ctx.fillText(text, i * fontSize, drop.y);
      drop.y += fontSize * drop.speed;
      if (drop.y > canvas.height + 50) {
        drop.y = Math.random() * -100;
        drop.speed = 0.5 + Math.random() * 1.5;
      }
    });
  }

  initMatrix();
  window.addEventListener("resize", initMatrix);
  setInterval(drawMatrix, 50);

  // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  function playVideoFromStart() {
    if (centerVideo && !fourthGiftSelected) {
      if (videoPlayTimeout) clearTimeout(videoPlayTimeout);
      centerVideo.currentTime = 0;
      centerVideo.play().catch(e => console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ'));
      videoPlayTimeout = setTimeout(() => {
        centerVideo.pause();
        centerVideo.currentTime = 0;
      }, 2000);
    }
  }

  function updateCenterSquareHighlight() {
    const centerSquare = document.getElementById('centerSquare');
    const filledCount = filledSlots.filter(filled => filled).length;
    if (filledCount > 0 && filledCount < 4 && !fourthGiftSelected) {
      centerSquare.classList.add('active-video');
    } else if (filledCount === 4) {
      centerSquare.classList.remove('active-video');
      centerSquare.classList.add('completed');
    } else {
      centerSquare.classList.remove('active-video', 'completed');
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –°–õ–û–¢–ê –∏–ª–∏ –ö–£–ë–ê (–≤–∏–¥–µ–æ, —Å –∑–∞–ø–∞—Å–Ω—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º)
  function createGiftContent(gift, forSlot = false) {
    const container = document.createElement('div');
    container.className = 'selected-gift active';

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–µ–æ —Å –≤–æ–∑–º–æ–∂–Ω—ã–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –æ—à–∏–±–æ–∫
    const tryCreateVideo = () => {
      const video = document.createElement('video');
      video.className = 'gift-img';
      video.src = `videos/${encodeURIComponent(gift.name)}.mp4`;
      video.muted = true;
      video.loop = true;
      video.autoplay = true;
      video.playsInline = true;
      video.setAttribute('webkit-playsinline', '');

      // –ï—Å–ª–∏ —ç—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
      if (!giftsWithMedia.has(gift.name)) {
        video.onerror = () => {
          // –ü—Ä–æ–±—É–µ–º –ø–æ–∫–∞–∑–∞—Ç—å PNG
          const img = new Image();
          img.onload = () => {
            container.innerHTML = '';
            img.className = 'gift-img';
            container.appendChild(img);
          };
          img.onerror = () => {
            // –ï—Å–ª–∏ –∏ PNG –Ω–µ—Ç ‚Äî —ç–º–æ–¥–∑–∏
            container.innerHTML = '';
            const emoji = document.createElement('div');
            emoji.className = 'gift-emoji';
            emoji.textContent = gift.emoji;
            container.appendChild(emoji);
          };
          img.src = `videos/${encodeURIComponent(gift.name)}.png`;
        };
      }

      video.oncanplay = () => video.play().catch(() => {});
      return video;
    };

    // –î–ª—è —Å–ª–æ—Ç–æ–≤ –∏ –∫—É–±–∞ –≤—Å–µ–≥–¥–∞ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥–µ–æ
    if (forSlot) {
      const video = tryCreateVideo();
      container.appendChild(video);
    } else {
      // –≠—Ç–∞ –≤–µ—Ç–∫–∞ –≤ —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞,
      // –Ω–æ –æ—Å—Ç–∞–≤–∏–º –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è (–µ—Å–ª–∏ –≤–¥—Ä—É–≥ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è)
      const img = new Image();
      img.className = 'gift-img';
      img.src = `videos/${encodeURIComponent(gift.name)}.png`;
      img.alt = gift.name;
      img.onerror = () => {
        container.innerHTML = '';
        const emoji = document.createElement('div');
        emoji.className = 'gift-emoji';
        emoji.textContent = gift.emoji;
        container.appendChild(emoji);
      };
      container.appendChild(img);
    }

    return container;
  }

  // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞ –∏–∑ —Å–ª–æ—Ç–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  function removeGiftFromSlot(slotIndex, event) {
    event.stopPropagation();
    const slotElement = document.querySelector(`.mini-square[data-slot="${slotIndex}"]`);
    const slotGiftContainer = document.getElementById(`gift-slot-${slotIndex}`);

    selectedGifts[slotIndex] = null;
    filledSlots[slotIndex] = false;
    fourthGiftSelected = false;

    slotGiftContainer.innerHTML = '';
    slotGiftContainer.classList.remove('active', 'durov-cap');
    slotElement.querySelector('.plus-sign').style.opacity = '1';
    slotElement.classList.remove('filled');

    const removeBtn = slotElement.querySelector('.remove-gift');
    if (removeBtn) removeBtn.remove();

    updateCenterSquareHighlight();

    if (centerVideo) {
      centerVideo.pause();
      centerVideo.currentTime = 0;
      if (videoPlayTimeout) clearTimeout(videoPlayTimeout);
    }

    updateModalSelection();
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  function updateModalSelection() {
    const giftItems = document.querySelectorAll('.gift-item');
    giftItems.forEach(item => {
      item.classList.remove('selected');
      const removeBtn = item.querySelector('.remove-selected');
      if (removeBtn) removeBtn.remove();
    });

    selectedGifts.forEach((gift, index) => {
      if (gift) {
        const giftItem = Array.from(giftItems).find(item => item.dataset.name === gift.name);
        if (giftItem) {
          giftItem.classList.add('selected');
          if (!giftItem.querySelector('.remove-selected')) {
            const removeBtn = document.createElement('div');
            removeBtn.className = 'remove-selected';
            removeBtn.innerHTML = '√ó';
            removeBtn.onclick = (e) => {
              e.stopPropagation();
              removeGiftFromSlot(index, e);
            };
            giftItem.appendChild(removeBtn);
          }
        }
      }
    });
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ 3D –∫—É–±–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç createGiftContent)
  function createGiftCube() {
    const cubeFaces = [
      document.getElementById('cube-face-0'),
      document.getElementById('cube-face-1'),
      document.getElementById('cube-face-2'),
      document.getElementById('cube-face-3')
    ];

    cubeFaces.forEach((face, index) => {
      if (selectedGifts[index]) {
        const gift = selectedGifts[index];
        const content = createGiftContent(gift, true); // –¥–ª—è –∫—É–±–∞ —Ç–æ–∂–µ –≤–∏–¥–µ–æ
        face.innerHTML = '';
        face.appendChild(content);
      }
    });

    const topFace = document.querySelector('.cube-face.top');
    const bottomFace = document.querySelector('.cube-face.bottom');
    if (selectedGifts[0]) {
      topFace.innerHTML = '<div class="selected-gift active"><div class="gift-emoji">‚ú®</div></div>';
      bottomFace.innerHTML = '<div class="selected-gift active"><div class="gift-emoji">üí´</div></div>';
    }
  }

  function mergeToCube() {
    const cornersContainer = document.getElementById('cornersContainer');
    const centerSquare = document.getElementById('centerSquare');
    const giftCubeContainer = document.getElementById('giftCubeContainer');

    cornersContainer.classList.add('merged');
    centerSquare.classList.add('merged');

    createGiftCube();
    giftCubeContainer.classList.add('active');
  }

  // –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  function sortGiftsByRelevance(gifts, searchTerm) {
    if (!searchTerm) return gifts;
    searchTerm = searchTerm.toLowerCase();
    return gifts.sort((a, b) => {
      const scoreA = getSearchScore(a.name, searchTerm);
      const scoreB = getSearchScore(b.name, searchTerm);
      if (scoreA !== scoreB) return scoreB - scoreA;
      return a.name.localeCompare(b.name);
    });
  }

  function getSearchScore(name, searchTerm) {
    const lowerName = name.toLowerCase();
    if (lowerName.startsWith(searchTerm)) return 1000;
    if (lowerName.includes(` ${searchTerm}`)) return 800;
    if (lowerName[0] === searchTerm[0]) return 500;
    if (lowerName.includes(searchTerm)) return 100;
    return 0;
  }

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏ (–∏–∑–º–µ–Ω–µ–Ω–æ: –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ —É–±–∏—Ä–∞–µ–º onerror)
  function filterAndSortGifts(searchTerm) {
    const filteredGifts = rareGifts.filter(gift =>
      gift.name.toLowerCase().includes(searchTerm.toLowerCase())
    );
    const sortedGifts = sortGiftsByRelevance(filteredGifts, searchTerm);

    const grid = document.getElementById('giftsGrid');
    grid.innerHTML = '';

    sortedGifts.forEach(gift => {
      const item = document.createElement('div');
      item.className = 'gift-item';
      item.dataset.name = gift.name;

      // –î–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (png)
      const img = document.createElement('img');
      img.className = 'gift-img';
      img.src = `videos/${encodeURIComponent(gift.name)}.png`;
      img.alt = gift.name;

      // –ï—Å–ª–∏ –ø–æ–¥–∞—Ä–æ–∫ –ù–ï –≤ —Å–ø–∏—Å–∫–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
      if (!giftsWithMedia.has(gift.name)) {
        img.onerror = () => {
          img.style.display = 'none';
          const emojiDiv = document.createElement('div');
          emojiDiv.className = 'gift-emoji';
          emojiDiv.textContent = gift.emoji;
          img.parentNode.replaceChild(emojiDiv, img);
        };
      }

      const giftImgDiv = document.createElement('div');
      giftImgDiv.className = 'gift-img';
      giftImgDiv.appendChild(img);

      const nameDiv = document.createElement('div');
      nameDiv.className = 'gift-name';
      nameDiv.textContent = gift.name;

      item.appendChild(giftImgDiv);
      item.appendChild(nameDiv);
      item.onclick = () => selectGiftForSlot(gift, currentSlotElement);
      grid.appendChild(item);
    });

    updateModalSelection();
  }

  function showGifts(slotElement) {
    currentSelectedSlot = slotElement.dataset.slot;
    currentSlotElement = slotElement;
    filterAndSortGifts('');
    document.getElementById('giftModal').classList.add('active');
  }

  // –í—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–∞ –¥–ª—è —Å–ª–æ—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç createGiftContent)
  function selectGiftForSlot(gift, slotElement) {
    const slotIndex = parseInt(currentSelectedSlot);
    if (filledSlots[slotIndex]) return;

    const slotGiftContainer = document.getElementById(`gift-slot-${slotIndex}`);
    selectedGifts[slotIndex] = gift;
    filledSlots[slotIndex] = true;

    slotGiftContainer.innerHTML = '';
    const content = createGiftContent(gift, true); // –¥–ª—è —Å–ª–æ—Ç–∞ –≤–∏–¥–µ–æ
    slotGiftContainer.appendChild(content);

    slotGiftContainer.classList.add('active');
    if (gift.name === "Durov's Cap") slotGiftContainer.classList.add('durov-cap');

    slotElement.querySelector('.plus-sign').style.opacity = '0';
    slotElement.classList.add('filled');

    const removeBtn = document.createElement('div');
    removeBtn.className = 'remove-gift';
    removeBtn.innerHTML = '√ó';
    removeBtn.onclick = (e) => removeGiftFromSlot(slotIndex, e);
    slotElement.appendChild(removeBtn);

    const filledCount = filledSlots.filter(filled => filled).length;
    if (filledCount === 4) {
      fourthGiftSelected = true;
      if (centerVideo) {
        centerVideo.pause();
        centerVideo.currentTime = 0;
        if (videoPlayTimeout) clearTimeout(videoPlayTimeout);
      }
      updateCenterSquareHighlight();
    } else {
      playVideoFromStart();
      updateCenterSquareHighlight();
    }

    updateModalSelection();
    document.getElementById('giftModal').classList.remove('active');
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  const user = tg.initDataUnsafe?.user;
  if (user && user.photo_url) {
    const avatar = document.getElementById("avatar");
    const img = document.createElement("img");
    img.src = user.photo_url;
    avatar.appendChild(img);

    setTimeout(() => {
      document.getElementById("matrix").style.opacity = "0";
      document.getElementById("videoWrapper").style.opacity = "0";
      document.getElementById("blackScreen").style.opacity = "1";
    }, 3000);

    setTimeout(() => {
      avatar.style.opacity = "1";
      document.getElementById("mainSquare").style.opacity = "1";

      document.querySelectorAll('.mini-square').forEach(square => {
        square.onclick = (e) => {
          if (e.target.classList.contains('remove-gift')) return;
          showGifts(square);
        };
      });

      document.getElementById('centerSquare').onclick = () => {
        if (filledSlots.filter(filled => filled).length === 4) {
          mergeToCube();
        }
      };
    }, 3500);
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  document.getElementById('searchInput')?.addEventListener('input', (e) => {
    filterAndSortGifts(e.target.value);
  });

  document.getElementById('closeModal').onclick = () => {
    document.getElementById('giftModal').classList.remove('active');
  };

  document.getElementById('giftModal').onclick = (e) => {
    if (e.target === document.getElementById('giftModal')) {
      document.getElementById('giftModal').classList.remove('active');
    }
  };
</script>
</body>
</html>