<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Telegram Craft</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:system-ui;
}
#app{position:relative;width:100%;height:100%;}

/* ===== СИНИЙ ЭКРАН ===== */
.blue-overlay{
  position:fixed;
  inset:0;
  background:radial-gradient(circle at center,#0a5cff,#002c88);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:opacity .4s ease;
  z-index:50;
}
.blue-overlay.active{
  opacity:1;
  pointer-events:auto;
}

/* ===== КУБ ===== */
.cube-wrap{
  width:90px;
  height:90px;
  perspective:600px;
}
.cube{
  width:100%;
  height:100%;
  position:relative;
  transform-style:preserve-3d;
  animation:idle 1.4s infinite ease-in-out;
}
@keyframes idle{
  0%,100%{transform:rotateX(-15deg) rotateY(20deg)}
  50%{transform:rotateX(-15deg) rotateY(20deg) translateY(-6px)}
}
.cube.open{
  animation:open .7s forwards ease-out;
}
@keyframes open{
  to{transform:scale(0);opacity:0}
}
.face{
  position:absolute;
  width:90px;
  height:90px;
  background:rgba(255,255,255,.15);
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:40px;
  color:#fff;
  border:2px solid rgba(255,255,255,.6);
}
.face.f{transform:translateZ(45px)}
.face.b{transform:rotateY(180deg) translateZ(45px)}
.face.r{transform:rotateY(90deg) translateZ(45px)}
.face.l{transform:rotateY(-90deg) translateZ(45px)}
.face.t{transform:rotateX(90deg) translateZ(45px)}
.face.d{transform:rotateX(-90deg) translateZ(45px)}

/* ===== СВЕЧЕНИЕ ===== */
.glow{
  position:absolute;
  width:0;height:0;
  border-radius:50%;
  background:radial-gradient(circle,rgba(255,255,255,.8),transparent 70%);
  transition:.4s;
}
.glow.active{
  width:260px;
  height:260px;
}

/* ===== ВЫПАВШИЙ ПРЕДМЕТ ===== */
.single{
  width:90px;
  height:90px;
  display:none;
  animation:pop .3s ease;
}
@keyframes pop{
  from{transform:scale(.5);opacity:0}
  to{transform:scale(1);opacity:1}
}
.single video{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* ===== РЯД ===== */
.row{
  display:flex;
  gap:12px;
  margin-top:24px;
  opacity:0;
}
.row.active{opacity:1}
.row video{
  width:60px;
  height:60px;
}

/* ===== СЧЁТЧИК ===== */
.counter{
  position:absolute;
  bottom:20px;
  right:20px;
  background:#ff0033;
  padding:10px 18px;
  border-radius:30px;
  font-weight:bold;
  color:#fff;
}
</style>
</head>

<body>
<div id="app">

<div class="blue-overlay" id="overlay">

  <div class="cube-wrap" id="cubeWrap">
    <div class="cube" id="cube">
      <div class="face f">?</div>
      <div class="face b">?</div>
      <div class="face r">?</div>
      <div class="face l">?</div>
      <div class="face t">?</div>
      <div class="face d">?</div>
    </div>
    <div class="glow" id="glow"></div>
  </div>

  <div class="single" id="single"></div>
  <div class="row" id="row"></div>
  <div class="counter" id="counter">4</div>

</div>

</div>

<script>
Telegram.WebApp.ready();
Telegram.WebApp.expand();

/* ===== ДАННЫЕ ===== */
const gifts=[
 {name:"Astral Shard",file:"Astral%20Shard.mp4"},
 {name:"Kissed Frog",file:"Kissed%20Frog.mp4"},
 {name:"Durov's Cap",file:"Durov-Cap.mp4"},
 {name:"Artisan Brick",file:"Artisan%20Brick.mp4"}
];

let index=0;
let stage="cube";

/* ===== СТАРТ (ИМИТАЦИЯ CRAFT) ===== */
setTimeout(()=>document.getElementById("overlay").classList.add("active"),1000);

/* ===== КЛИК ПО ЭКРАНУ ===== */
overlay.addEventListener("click",()=>{

  if(stage==="cube"){
    cube.classList.add("open");
    glow.classList.add("active");
    stage="drop";
    setTimeout(()=>{
      cubeWrap.style.display="none";
      glow.style.display="none";
      showGift();
    },700);
    return;
  }

  if(stage==="drop"){
    index++;
    counter.textContent=4-index;
    if(index<gifts.length){
      showGift();
    }else{
      showRow();
      stage="final";
    }
    return;
  }

  if(stage==="final"){
    location.reload();
  }
});

/* ===== ФУНКЦИИ ===== */
function showGift(){
  single.innerHTML="";
  const v=document.createElement("video");
  v.src="videos/"+gifts[index].file;
  v.autoplay=true;
  v.loop=true;
  v.muted=true;
  v.playsInline=true;
  single.appendChild(v);
  single.style.display="block";
}

function showRow(){
  single.style.display="none";
  gifts.forEach(g=>{
    const v=document.createElement("video");
    v.src="videos/"+g.file;
    v.autoplay=true;
    v.loop=true;
    v.muted=true;
    row.appendChild(v);
  });
  row.classList.add("active");
}
</script>
</body>
</html>