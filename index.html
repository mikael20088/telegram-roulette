<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Telegram Roulette</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏—Ö –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π) */
    /* ... */
  </style>
</head>
<body>
<div id="app">
  <div class="black-screen" id="blackScreen"></div>
  <canvas id="matrix"></canvas>
  <div class="video-wrapper" id="videoWrapper">
    <video src="roulette.webm" autoplay loop muted playsinline webkit-playsinline></video>
  </div>
  <div class="avatar-top" id="avatar"></div>
  <div class="main-square" id="mainSquare">
    <div class="corners-container" id="cornersContainer">
      <div class="mini-square" data-slot="0"><div class="plus-sign">+</div><div class="selected-gift" id="gift-slot-0"></div></div>
      <div class="mini-square" data-slot="1"><div class="plus-sign">+</div><div class="selected-gift" id="gift-slot-1"></div></div>
      <div class="mini-square" data-slot="2"><div class="plus-sign">+</div><div class="selected-gift" id="gift-slot-2"></div></div>
      <div class="mini-square" data-slot="3"><div class="plus-sign">+</div><div class="selected-gift" id="gift-slot-3"></div></div>
    </div>
    <div class="center-mini-square" id="centerSquare">
      <video class="center-video" src="center-video.mp4" muted playsinline webkit-playsinline></video>
    </div>
    <div class="gift-cube-container" id="giftCubeContainer">
      <div class="gift-cube" id="giftCube">
        <div class="cube-face front" id="cube-face-0"></div>
        <div class="cube-face back" id="cube-face-1"></div>
        <div class="cube-face right" id="cube-face-2"></div>
        <div class="cube-face left" id="cube-face-3"></div>
        <div class="cube-face top"></div>
        <div class="cube-face bottom"></div>
      </div>
    </div>
  </div>
</div>
<div class="modal" id="giftModal">
  <div class="modal-content">
    <div class="close-btn" id="closeModal">√ó</div>
    <h3 style="color: #fff; margin: 0 0 20px; text-align: center;">–†–µ–¥–∫–∏–µ –ø–æ–¥–∞—Ä–∫–∏</h3>
    <div class="search-container">
      <input type="text" class="search-input" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ–¥–∞—Ä–∫–æ–≤..." />
      <span class="search-icon">üîç</span>
    </div>
    <div class="gifts-grid" id="giftsGrid"></div>
  </div>
</div>

<script>
(function() {
  // –ñ–¥—ë–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  async function init() {
    try {
      const tg = Telegram.WebApp;
      tg.ready();
      tg.expand();

      // ----- –ù–ê–°–¢–†–û–ô–ö–ò -----
      const MAIN_VIDEO_SRC = 'roulette.webm';
      const CENTER_VIDEO_SRC = 'center-video.mp4';

      // ----- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï -----
      let selectedGifts = [null, null, null, null];
      let filledSlots = [false, false, false, false];
      let fourthGiftSelected = false;
      let videoPlayTimeout = null;
      let currentSelectedSlot = null;
      let currentSlotElement = null;

      let pngSet = new Set();
      let mp4Set = new Set();
      let manifestLoaded = false;

      // ----- –ü–û–õ–ù–´–ô –ö–ê–¢–ê–õ–û–ì –ü–û–î–ê–†–ö–û–í (80+) -----
      const rareGifts = [
        { name: "Durov's Cap", emoji: "üé©" },
        { name: "Top Hat", emoji: "üé©" },
        { name: "Astral Shard", emoji: "üíé" },
        { name: "Mini Oscar", emoji: "üèÜ" },
        { name: "Electric Skull", emoji: "üíÄ" },
        { name: "Diamond Ring", emoji: "üíç" },
        { name: "Stellar Rocket", emoji: "üöÄ" },
        { name: "Trapped Heart", emoji: "üíñ" },
        { name: "Gem Signet", emoji: "üîÆ" },
        { name: "Artisan Brick", emoji: "üß±" },
        { name: "Sharp Tongue", emoji: "üó°" },
        { name: "Jack-in-the-Box", emoji: "üéÅ" },
        { name: "Witch Hat", emoji: "üéÉ" },
        { name: "Moon Pendant", emoji: "üåô" },
        { name: "Lunar Snake", emoji: "üêç" },
        { name: "Holiday Drink", emoji: "ü•Ç" },
        { name: "Record Player", emoji: "üéµ" },
        { name: "Joyful Bundle", emoji: "üéâ" },
        { name: "Restless Jar", emoji: "ü´ô" },
        { name: "Big Year", emoji: "üéà" },
        { name: "Light Sword", emoji: "‚öîÔ∏è" },
        { name: "Jingle Bells", emoji: "üîî" },
        { name: "Eternal Candle", emoji: "üïØ" },
        { name: "Skull Flower", emoji: "üíÄüå∏" },
        { name: "Sakura Flower", emoji: "üå∏" },
        { name: "Jelly Bunny", emoji: "üê∞" },
        { name: "Cupid Charm", emoji: "üíò" },
        { name: "Hanging Star", emoji: "‚≠êÔ∏è" },
        { name: "Easter Egg", emoji: "ü•ö" },
        { name: "Spy Agaric", emoji: "üçÑ" },
        { name: "Homemade Cake", emoji: "üç∞" },
        { name: "Snow Globe", emoji: "‚ùÑÔ∏è" },
        { name: "Xmas Stocking", emoji: "üß¶" },
        { name: "Scared Cat", emoji: "üòø" },
        { name: "Spiced Wine", emoji: "üç∑" },
        { name: "Evil Eye", emoji: "üëÅ" },
        { name: "Ionic Dryer", emoji: "üí®" },
        { name: "Ginger Cookie", emoji: "üç™" },
        { name: "Hex Pot", emoji: "ü™£" },
        { name: "Snake Box", emoji: "üêçüì¶" },
        { name: "Loot Bag", emoji: "üí∞" },
        { name: "Love Candle", emoji: "‚ù§Ô∏èüïØ" },
        { name: "Love Potion", emoji: "üíï" },
        { name: "Kissed Frog", emoji: "üê∏" },
        { name: "Neko Helmet", emoji: "üê±‚õë" },
        { name: "Pet Snake", emoji: "üêç" },
        { name: "Jester Hat", emoji: "ü§°" },
        { name: "Flying Broom", emoji: "üßπ" },
        { name: "Party Sparkler", emoji: "‚ú®" },
        { name: "Star Notepad", emoji: "‚≠êÔ∏èüìù" },
        { name: "Voodoo Doll", emoji: "üéé" },
        { name: "Bonded Ring", emoji: "üíû" },
        { name: "Snow Mittens", emoji: "üß§" },
        { name: "Crystal Ball", emoji: "üîÆ" },
        { name: "Berry Box", emoji: "üçì" },
        { name: "Tama Gadget", emoji: "üì±" },
        { name: "Valentine Box", emoji: "üíù" },
        { name: "Cookie Heart", emoji: "‚ù§Ô∏èüç™" },
        { name: "Precious Peach", emoji: "üçë" },
        { name: "Bow Tie", emoji: "üéÄ" },
        { name: "Signet Ring", emoji: "üíé" },
        { name: "Lol Pop", emoji: "üç≠" },
        { name: "Santa Hat", emoji: "üéÖ" },
        { name: "Hypno Lollipop", emoji: "üç¨" },
        { name: "Winter Wreath", emoji: "üéÑ" },
        { name: "Vintage Cigar", emoji: "üö¨" },
        { name: "Bunny Muffin", emoji: "üê∞üßÅ" },
        { name: "Mad Pumpkin", emoji: "üéÉ" },
        { name: "Eternal Rose", emoji: "üåπ" },
        { name: "Jolly Chimp", emoji: "üêµ" },
        { name: "Toy Bear", emoji: "üß∏" },
        { name: "Candy Cane", emoji: "üç≠" },
        { name: "Sleigh Bell", emoji: "üîî" },
        { name: "Swiss Watch", emoji: "‚åöÔ∏è" },
        { name: "Genie Lamp", emoji: "ü™î" },
        { name: "Plush Pepe", emoji: "üê∏" },
        { name: "Perfume Bottle", emoji: "üí®" },
        { name: "Magic Potion", emoji: "üß™" },
        { name: "Ion Gem", emoji: "üíé" },
        { name: "Desk Calendar", emoji: "üóì" },
        { name: "B-Day Candle", emoji: "üïØ" }
      ];

      // ----- –ó–ê–ì–†–£–ó–ö–ê MANIFEST -----
      async function loadManifest() {
        try {
          const response = await fetch('videos/manifest.json');
          if (!response.ok) throw new Error('Manifest not found');
          const manifest = await response.json();
          pngSet = new Set(manifest.png || []);
          mp4Set = new Set(manifest.mp4 || []);
          manifestLoaded = true;
          console.log('Manifest loaded');
        } catch (e) {
          console.warn('Manifest loading failed, using fallback mode');
          manifestLoaded = false;
        }
      }

      // ----- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò -----
      function hasPng(gift) {
        return manifestLoaded ? pngSet.has(gift.name + '.png') : true;
      }
      function hasMp4(gift) {
        return manifestLoaded ? mp4Set.has(gift.name + '.mp4') : true;
      }

      // –î–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ (–≤—Å–µ–≥–¥–∞ PNG)
      function createCatalogGiftElement(gift) {
        const container = document.createElement('div');
        container.className = 'gift-img';
        if (hasPng(gift)) {
          const img = new Image();
          img.src = `videos/${encodeURIComponent(gift.name)}.png`;
          img.alt = gift.name;
          img.onerror = () => {
            container.innerHTML = '';
            const emoji = document.createElement('div');
            emoji.className = 'gift-emoji';
            emoji.textContent = gift.emoji;
            container.appendChild(emoji);
          };
          container.appendChild(img);
        } else {
          const emoji = document.createElement('div');
          emoji.className = 'gift-emoji';
          emoji.textContent = gift.emoji;
          container.appendChild(emoji);
        }
        return container;
      }

      // –î–ª—è —Å–ª–æ—Ç–æ–≤ –∏ –∫—É–±–∞ (–≤–∏–¥–µ–æ -> PNG -> —ç–º–æ–¥–∑–∏)
      function createSlotGiftContent(gift) {
        const wrapper = document.createElement('div');
        wrapper.className = 'selected-gift active';

        const tryShowVideo = () => {
          if (hasMp4(gift)) {
            const video = document.createElement('video');
            video.className = 'gift-img';
            video.src = `videos/${encodeURIComponent(gift.name)}.mp4`;
            video.muted = true;
            video.loop = true;
            video.autoplay = true;
            video.playsInline = true;
            video.setAttribute('webkit-playsinline', '');
            video.onerror = () => {
              wrapper.innerHTML = '';
              tryShowImage();
            };
            wrapper.appendChild(video);
            return true;
          }
          return false;
        };

        const tryShowImage = () => {
          if (hasPng(gift)) {
            const img = new Image();
            img.className = 'gift-img';
            img.src = `videos/${encodeURIComponent(gift.name)}.png`;
            img.alt = gift.name;
            img.onerror = () => {
              wrapper.innerHTML = '';
              const emoji = document.createElement('div');
              emoji.className = 'gift-emoji';
              emoji.textContent = gift.emoji;
              wrapper.appendChild(emoji);
            };
            wrapper.appendChild(img);
          } else {
            const emoji = document.createElement('div');
            emoji.className = 'gift-emoji';
            emoji.textContent = gift.emoji;
            wrapper.appendChild(emoji);
          }
        };

        if (!tryShowVideo()) tryShowImage();
        return wrapper;
      }

      // ----- –ú–ê–¢–†–ò–¶–ê -----
      const canvas = document.getElementById('matrix');
      if (!canvas) throw new Error('Canvas not found');
      const ctx = canvas.getContext('2d');
      let drops = [];
      const chars = '01ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789';
      const fontSize = 14;

      function initMatrix() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const columns = Math.floor(canvas.width / fontSize);
        drops = Array.from({ length: columns }, () => ({
          y: Math.random() * canvas.height,
          speed: 0.5 + Math.random() * 1.5
        }));
      }

      function drawMatrix() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.08)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#00ff88';
        ctx.font = fontSize + 'px monospace';
        drops.forEach((drop, i) => {
          const text = chars[Math.floor(Math.random() * chars.length)];
          ctx.fillText(text, i * fontSize, drop.y);
          drop.y += fontSize * drop.speed;
          if (drop.y > canvas.height + 50) {
            drop.y = Math.random() * -100;
            drop.speed = 0.5 + Math.random() * 1.5;
          }
        });
      }

      window.addEventListener('resize', initMatrix);
      initMatrix();
      setInterval(drawMatrix, 50);

      // ----- –í–ò–î–ï–û–¶–ï–ù–¢–† -----
      const centerVideo = document.querySelector('.center-video');
      if (centerVideo) {
        centerVideo.pause();
        centerVideo.currentTime = 0;
      } else {
        console.warn('Center video element not found');
      }

      function playVideoFromStart() {
        if (centerVideo && !fourthGiftSelected) {
          if (videoPlayTimeout) clearTimeout(videoPlayTimeout);
          centerVideo.currentTime = 0;
          centerVideo.play().catch(() => {});
          videoPlayTimeout = setTimeout(() => {
            centerVideo.pause();
            centerVideo.currentTime = 0;
          }, 2000);
        }
      }

      function updateCenterSquareHighlight() {
        const centerSquare = document.getElementById('centerSquare');
        if (!centerSquare) return;
        const filledCount = filledSlots.filter(Boolean).length;
        if (filledCount > 0 && filledCount < 4 && !fourthGiftSelected) {
          centerSquare.classList.add('active-video');
        } else if (filledCount === 4) {
          centerSquare.classList.remove('active-video');
          centerSquare.classList.add('completed');
        } else {
          centerSquare.classList.remove('active-video', 'completed');
        }
      }

      // ----- –£–î–ê–õ–ï–ù–ò–ï –ü–û–î–ê–†–ö–ê –ò–ó –°–õ–û–¢–ê -----
      function removeGiftFromSlot(slotIndex, event) {
        event.stopPropagation();
        const slotElement = document.querySelector(`.mini-square[data-slot="${slotIndex}"]`);
        const slotGiftContainer = document.getElementById(`gift-slot-${slotIndex}`);
        if (!slotElement || !slotGiftContainer) return;

        selectedGifts[slotIndex] = null;
        filledSlots[slotIndex] = false;
        fourthGiftSelected = false;

        slotGiftContainer.innerHTML = '';
        slotGiftContainer.classList.remove('active', 'durov-cap');
        const plus = slotElement.querySelector('.plus-sign');
        if (plus) plus.style.opacity = '1';
        slotElement.classList.remove('filled');

        const removeBtn = slotElement.querySelector('.remove-gift');
        if (removeBtn) removeBtn.remove();

        updateCenterSquareHighlight();

        if (centerVideo) {
          centerVideo.pause();
          centerVideo.currentTime = 0;
          if (videoPlayTimeout) clearTimeout(videoPlayTimeout);
        }
        updateModalSelection();
      }

      // ----- –û–ë–ù–û–í–õ–ï–ù–ò–ï –í–´–î–ï–õ–ï–ù–ò–Ø –í –ú–û–î–ê–õ–ö–ï -----
      function updateModalSelection() {
        const giftItems = document.querySelectorAll('.gift-item');
        giftItems.forEach(item => {
          item.classList.remove('selected');
          const rm = item.querySelector('.remove-selected');
          if (rm) rm.remove();
        });
        selectedGifts.forEach((gift, idx) => {
          if (!gift) return;
          const target = Array.from(giftItems).find(item => item.dataset.name === gift.name);
          if (target) {
            target.classList.add('selected');
            if (!target.querySelector('.remove-selected')) {
              const rm = document.createElement('div');
              rm.className = 'remove-selected';
              rm.innerHTML = '√ó';
              rm.onclick = (e) => removeGiftFromSlot(idx, e);
              target.appendChild(rm);
            }
          }
        });
      }

      // ----- –°–û–ó–î–ê–ù–ò–ï 3D –ö–£–ë–ê -----
      function createGiftCube() {
        const faces = [
          document.getElementById('cube-face-0'),
          document.getElementById('cube-face-1'),
          document.getElementById('cube-face-2'),
          document.getElementById('cube-face-3')
        ];
        faces.forEach((face, i) => {
          if (face && selectedGifts[i]) {
            face.innerHTML = '';
            face.appendChild(createSlotGiftContent(selectedGifts[i]));
          }
        });
        const top = document.querySelector('.cube-face.top');
        const bottom = document.querySelector('.cube-face.bottom');
        if (top && bottom && selectedGifts[0]) {
          top.innerHTML = '<div class="selected-gift active"><div class="gift-emoji">‚ú®</div></div>';
          bottom.innerHTML = '<div class="selected-gift active"><div class="gift-emoji">üí´</div></div>';
        }
      }

      function mergeToCube() {
        const corners = document.getElementById('cornersContainer');
        const center = document.getElementById('centerSquare');
        const cubeContainer = document.getElementById('giftCubeContainer');
        if (corners) corners.classList.add('merged');
        if (center) center.classList.add('merged');
        createGiftCube();
        if (cubeContainer) cubeContainer.classList.add('active');
      }

      // ----- –ü–û–ò–°–ö -----
      function getSearchScore(name, term) {
        const low = name.toLowerCase();
        if (low.startsWith(term)) return 1000;
        if (low.includes(' ' + term)) return 800;
        if (low[0] === term[0]) return 500;
        if (low.includes(term)) return 100;
        return 0;
      }

      function sortGiftsByRelevance(gifts, term) {
        if (!term) return gifts;
        term = term.toLowerCase();
        return gifts.sort((a, b) => {
          const sa = getSearchScore(a.name, term);
          const sb = getSearchScore(b.name, term);
          return sb - sa || a.name.localeCompare(b.name);
        });
      }

      // ----- –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò –û–¢–†–ò–°–û–í–ö–ê –°–ï–¢–ö–ò -----
      function filterAndSortGifts(searchTerm) {
        const filtered = rareGifts.filter(g => g.name.toLowerCase().includes(searchTerm.toLowerCase()));
        const sorted = sortGiftsByRelevance(filtered, searchTerm);
        const grid = document.getElementById('giftsGrid');
        if (!grid) return;
        grid.innerHTML = '';

        sorted.forEach(gift => {
          const item = document.createElement('div');
          item.className = 'gift-item';
          item.dataset.name = gift.name;

          const imgDiv = createCatalogGiftElement(gift);
          const nameDiv = document.createElement('div');
          nameDiv.className = 'gift-name';
          nameDiv.textContent = gift.name;

          item.appendChild(imgDiv);
          item.appendChild(nameDiv);
          item.onclick = () => selectGiftForSlot(gift, currentSlotElement);
          grid.appendChild(item);
        });

        updateModalSelection();
      }

      // ----- –ü–û–ö–ê–ó –ú–û–î–ê–õ–ö–ò -----
      function showGifts(slotElement) {
        if (!slotElement) return;
        currentSelectedSlot = slotElement.dataset.slot;
        currentSlotElement = slotElement;
        filterAndSortGifts('');
        const modal = document.getElementById('giftModal');
        if (modal) modal.classList.add('active');
      }

      // ----- –í–´–ë–û–† –ü–û–î–ê–†–ö–ê –î–õ–Ø –°–õ–û–¢–ê -----
      function selectGiftForSlot(gift, slotElement) {
        if (!slotElement) return;
        const slotIndex = parseInt(currentSelectedSlot);
        if (filledSlots[slotIndex]) return;

        const slotGiftContainer = document.getElementById(`gift-slot-${slotIndex}`);
        if (!slotGiftContainer) return;

        selectedGifts[slotIndex] = gift;
        filledSlots[slotIndex] = true;

        slotGiftContainer.innerHTML = '';
        slotGiftContainer.appendChild(createSlotGiftContent(gift));
        slotGiftContainer.classList.add('active');
        if (gift.name === "Durov's Cap") slotGiftContainer.classList.add('durov-cap');

        const plus = slotElement.querySelector('.plus-sign');
        if (plus) plus.style.opacity = '0';
        slotElement.classList.add('filled');

        const removeBtn = document.createElement('div');
        removeBtn.className = 'remove-gift';
        removeBtn.innerHTML = '√ó';
        removeBtn.onclick = (e) => removeGiftFromSlot(slotIndex, e);
        slotElement.appendChild(removeBtn);

        const filledCount = filledSlots.filter(Boolean).length;
        if (filledCount === 4) {
          fourthGiftSelected = true;
          if (centerVideo) {
            centerVideo.pause();
            centerVideo.currentTime = 0;
            if (videoPlayTimeout) clearTimeout(videoPlayTimeout);
          }
          updateCenterSquareHighlight();
        } else {
          playVideoFromStart();
          updateCenterSquareHighlight();
        }

        updateModalSelection();
        const modal = document.getElementById('giftModal');
        if (modal) modal.classList.remove('active');
      }

      // ----- –£–°–¢–ê–ù–û–í–ö–ê –°–ö–û–†–û–°–¢–ò –û–°–ù–û–í–ù–û–ì–û –í–ò–î–ï–û -----
      const mainVideo = document.querySelector('#videoWrapper video');
      if (mainVideo) mainVideo.playbackRate = 0.7;

      // ----- –ó–ê–ì–†–£–ó–ö–ê MANIFEST –ò –ó–ê–ü–£–°–ö –ò–ù–¢–ï–†–§–ï–ô–°–ê -----
      await loadManifest();

      const user = tg.initDataUnsafe?.user;
      if (user && user.photo_url) {
        const avatar = document.getElementById('avatar');
        if (avatar) {
          const img = document.createElement('img');
          img.src = user.photo_url;
          avatar.appendChild(img);
        }

        setTimeout(() => {
          const matrix = document.getElementById('matrix');
          const wrapper = document.getElementById('videoWrapper');
          const black = document.getElementById('blackScreen');
          if (matrix) matrix.style.opacity = '0';
          if (wrapper) wrapper.style.opacity = '0';
          if (black) black.style.opacity = '1';
        }, 3000);

        setTimeout(() => {
          if (avatar) avatar.style.opacity = '1';
          const mainSquare = document.getElementById('mainSquare');
          if (mainSquare) mainSquare.style.opacity = '1';

          document.querySelectorAll('.mini-square').forEach(sq => {
            sq.onclick = (e) => {
              if (e.target.classList.contains('remove-gift')) return;
              showGifts(sq);
            };
          });

          const center = document.getElementById('centerSquare');
          if (center) {
            center.onclick = () => {
              if (filledSlots.filter(Boolean).length === 4) mergeToCube();
            };
          }
        }, 3500);
      }

      // ----- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ú–û–î–ê–õ–ö–ò -----
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => filterAndSortGifts(e.target.value));
      }

      const closeBtn = document.getElementById('closeModal');
      if (closeBtn) {
        closeBtn.onclick = () => {
          const modal = document.getElementById('giftModal');
          if (modal) modal.classList.remove('active');
        };
      }

      const modal = document.getElementById('giftModal');
      if (modal) {
        modal.onclick = (e) => {
          if (e.target === modal) modal.classList.remove('active');
        };
      }

    } catch (err) {
      console.error('Initialization error:', err);
      // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ-—Ç–æ –ø—Ä–æ—Å—Ç–æ–µ, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –±–µ–ª–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
      document.body.innerHTML = '<div style="color:white;padding:20px;">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</div>';
    }
  }
})();
</script>
</body>
</html>